# **Общие понятия**

Микросервис **linkOp** – микросервис для управления линками Оператора.

**Список запросов API:**

Все ответы приходят в виде:

```json

{
  "meta": {
        "code": 1,
        "error": "not found",
        "rid": "2fdb1bc8-12f3-44f0-ad15-2a603128585f",
        "time": "0.064ms"
  },
  "response": {}
}

```

идентификатор ответа **rid** может использоваться в дальнейшем для идентификации конкретного запроса в случае
возникновения проблем.

# Ресурс "Линки" (links)

Ресурс содержит список **Линков** зарегистрированных в Сервисе.

Каждый Линк имеет следующие поля:

* `lid` - уникальный идентификатор записи о Линке
* `compid` - идентификатор организации, к которой относится линк
* `depid` - идентификатор подразделения организации, к которой относится линк
* `type` - тип Линка (например `LINKOP-MSG-HOLDER`)
* `name` - наименовние Линка
* `dir` - направление работы линка (`input`, `output`)
* `status` - статус линка (`runnig`, `stoped`)
* `comsts` - статус соединения (`connecting`, `connected` и т.д.)
* `created` - время создания линка
* `updated` - время обновления линка
* `last_activity_time` - время последней активности линка


Каждый линк может быть нескольких типов (поле `type`):

* `SEBA_SGS_DOWN` - линк оператора


**Запросы**

## 1. Список Линков

**Назначение:** для получения списка зарегистрированных в системе Линков.

**Запрос** `/api/v1/links/list`

**Тип запроса:** GET

**Параметры**:

**Возможные параметры**:

| **имя поля**   | **тип**    | **описание**                                                               |
|----------------|------------|----------------------------------------------------------------------------|
| `compid`       | `[]uuid`   | список идентификаторов организаций, которым принадлежат Линки              |
| `depid`        | `[]uuid`   | список идентификаторов подразделений, которым принадлежат Линки            |
| `lid`          | `[]uuid`   | список идентификаторов Линков                                              |
| `type`         | `[]string` | список типов Линков                                                        |
| `updatedFrom`  | `unixtime` | выдача по времени обновления записи                                        |
| `searchStr`    | `string`   | строка поиска по полям из `search`                                         | 
| `search`       | `[]string` | устанавливает по каким полям делать поиск `searchStr`. Возможные значения: | 
| `-lid`         | `opt`      | поиск по идентификатору Линка                                              | 
| `-name`        | `opt`      | поиск по имени Линка                                                       | 
| `-type`        | `opt`      | поиск по типу                                                              | 
| `order`        | `[]string` | устанавливает сортировку выдачи списка. Возможные значения в массиве:      | 
| `-lid`         | `opt`      | сортировка по идентификаторам,                                             | 
| `-comp`        | `opt`      | сортировка по организации, которой принадлежит линк                        | 
| `-dep`         | `opt`      | сортировка по подразделению, которой принадлежит линк                      | 
| `-name`        | `opt`      | сортировка по имени                                                        | 
| `-type`        | `opt`      | сортировка по типу                                                         | 
| `-created`     | `opt`      | сортировка по времени создания                                             | 
| `-updated`     | `opt`      | сортировка по времени обновления                                           | 
| `orderDir`     | `string`   | устанавливает направление сортировки выдачи списка. `asc` или `desc`       | 
| `flag `        | `string`   | массив параметров выдачи через запятую. Значения:                          | 
| `-all`         | `opt`      | отображать активные записи + архивные                                      |
| `-archiveonly` | `opt`      | отобразить только архивные записи                                          |

**Примеры:**

`/api/v1/links/list`, `/api/v1/links/list?page=2&flag=archiveonly`

**Ответ:**

```json

{
    "meta": {
        "code": 0,
        "rid": "5b4eccd8-dc49-407d-a984-00177e76ce13",
        "time": "11.815ms"
    },
    "response": {
        "links": [
            {
                "lid": "6de1e065-0725-435d-8453-56c278cac5ce",
                "type": "LINKOP-MSG-HOLDER",
                "dir": "input",
                "name": "ch1-bad-msgs",
                "compid": "85697f9f-b80d-4668-8ed2-2f70ed825eee",
                "depid": "00000000-0000-0000-0000-000000000000",
                "status": "running",
                "comsts": "connected",
                "data": {
                    "autostart": false,
                    "settings": null,
                    "snapshot": null
                },
                "connStats": null,
                "created": 1746514336,
                "updated": 1759495586,
                "archived": null,
                "counters": {
                    "sent": 0,
                    "recv": 0
                },
                "last_activity_time": 1760365620
            },
            {
                "lid": "6de1e065-0725-435d-8453-56c278cac5ce",
                "type": "LINKOP-MSG-HOLDER",
                "dir": "input",
                "name": "ch1-bad-msgs",
                "compid": "85697f9f-b80d-4668-8ed2-2f70ed825eee",
                "depid": "00000000-0000-0000-0000-000000000000",
                "status": "running",
                "comsts": "connected",
                "data": {
                    "autostart": false,
                    "settings": null,
                    "snapshot": null
                },
                "connStats": null,
                "created": 1746514336,
                "updated": 1759495586,
                "archived": null,
                "counters": {
                    "sent": 0,
                    "recv": 0
                },
                "last_activity_time": 1760365620
            }
        ]
    }
}
```

**Возможные поля ответа:**

| **имя поля**         | **тип**       | ** описание**                                                       |
|----------------------|---------------|---------------------------------------------------------------------|
| `lid`                | `uuid`        | уникальный идентификатор Линки                                      |
| `compid`             | `uuid`        | идентификатор организации, которой принадлежит линк                 |
| `depid`              | `uuid`        | идентификатор подразделения, которому принадлежит линк              |
| `type`               | `string[255]` | тип Линки - ее идентификатор                                        |
| `name`               | `string[255]` | наименование Линки                                                  |
| `dir`                | `string[16]`  | направление работы линка                                            |
| `last_activity_time` | `unixtime`    | время последней активности линка (прием/передача данных и пр.)      |
| `status`             | `string`      | текущий статус. Может принимать значения:                           |
| `-init`              |               | линк инициализируется после запуска,                                |
| `-stop`              |               | линк остановлен,                                                    |
| `-starting`          |               | линк стартует (произведен вызов **/start**),                        |
| `-running`           |               | линк стартован и выполняет свою работу                              |
| `-stopping`          |               | линк останавливается (произведен вызов **/stop**).                  |
| `-error`             |               | линк находится в ошибочном состоянии                                |
| `comsts`             | `string`      | текущий статус соединения. Может принимать значения:                |
| `-connecting`        |               | соединение устанавливается,                                         |
| `-connected`         |               | соединение установлено,                                             |
| `-disconnecting`     |               | соединение разрывается,                                             |
| `-disconnected`      |               | соединение разорвано                                                |

## 2. Информация по указанному Линку

**Назначение:** для получения информации по указанному Линку

**Запрос** `/api/v1/links/LINK_ID/info`

где `LINK_ID` – идентификатор Линки

**Тип запроса:** GET

**Возможные параметры:**  нет

**Пример:**  `/api/v1/links/dea50f0c-f55f-4063-9f17-e45ae8c03bce/info`

**Ответ:**

```json

{
    "meta": {
        "code": 0,
        "rid": "2ffcf70b-8610-4f46-becc-f0e626c2e889",
        "time": "6.779ms"
    },
    "response": {
        "lid": "6de1e065-0725-435d-8453-56c278cac5ce",
        "type": "LINKOP-MSG-HOLDER",
        "dir": "input",
        "name": "ch1-bad-msgs",
        "compid": "85697f9f-b80d-4668-8ed2-2f70ed825eee",
        "depid": "00000000-0000-0000-0000-000000000000",
        "status": "running",
        "comsts": "connected",
        "data": {
            "autostart": true,
            "settings": {
            },
            "snapshot": null
        },
        "connStats": [],
        "created": 1746514336,
        "updated": 1759495586,
        "archived": null,
        "counters": {
            "sent": 0,
            "recv": 0
        },
        "last_activity_time": 1760365620
    }
}

```

**Возможные поля ответа:**

| **имя поля**         | **тип**       | **описание**                                                                                 |
|----------------------|---------------|----------------------------------------------------------------------------------------------|
| `lid`                | `uuid`        | уникальный идентификатор Линки                                                               |
| `compid`             | `uuid`        | идентификатор организации, которой принадлежит линк                                          |
| `depid`              | `uuid`        | идентификатор подразделения, которому принадлежит линк                                       |
| `type`               | `string[255]` | тип Линки - ее идентификатор                                                                 |
| `name`               | `string[255]` | наименование Линки                                                                           |
| `dir`                | `string[16]`  | направление работы линка (upload, download)                                                  |
| `data`               | `json`        | данные линка                                                                                 |
| `comsts`             | `string`      | текущий коммуникационный статус. Может принимать значения: "idle", "connecting", "connected" |
| `last_activity_time` | `unixtime`    | время последней активности линка (прием/передача данных и пр.)                               |
| `status`             | `string`      | текущий статус. Может принимать значения:                                                    |
| `-init`              |               | линк инициализируется после запуска,                                                         |
| `-stop`              |               | линк остановлен,                                                                             |
| `-starting`          |               | линк стартует (произведен вызов **/start**),                                                 |
| `-running`           |               | линк стартован и выполняет свою работу                                                       |
| `-stopping`          |               | линк останавливается (произведен вызов **/stop**).                                           |
| `-error`             |               | линк находится в ошибочном состоянии                                                         |
| `comsts`             | `string`      | текущий статус соединения. Может принимать значения:                                         |
| `-connecting`        |               | соединение устанавливается,                                                                  |
| `-connected`         |               | соединение установлено,                                                                      |
| `-disconnecting`     |               | соединение разрывается,                                                                      |
| `-disconnected`      |               | соединение разорвано                                                                         |

## 3. Создать новую запись о Линке

**Назначение:** для регистрации нового Линка.

**Запрос** `/api/v1/links/new`

**Тип запроса:** POST

**Пример:**  `/api/v1/links/new`

Передаваемые данные:

```json

{
  "lid": "4CF0DBF0-820B-4E05-A819-B6D1EC5652FB",
  "type": "LINKOP-MSG-HOLDER",
  "name": "тестовый FTP клиент",
  "dir": "input",
  "compid": "4CF0DBF0-820B-4E05-A819-B6D1EC5652FB",
  "depid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
}

```

**Ответ:**

```json

{
  "lid": "dea50f0c-f55f-4063-9f17-e45ae8c03bce"
}

``` 

**Обязательные параметры:**

| **имя поля** | **тип**       | **описание**                                           |
|--------------|---------------|--------------------------------------------------------|
| `type`       | `string[255]` | тип линка.                                             |
| `compid`     | `uuid`        | идентификатор органиазции к которому привязан линк     |
| `depid`      | `uuid`        | идентификатор подразделения, которому принадлежит линк |
| `dir`        | `string[16]`  | направление работы линка                               |

**Необязательные параметры:**

| **имя поля** | **тип**  | **описание**                   |
|--------------|----------|--------------------------------|
| `lid`        | `uuid`   | уникальный идентификатор линка |
| `name`       | `string` | название линка                 |
| `data`       | `json`   | параметры линка                |

Если при создании Линка не указывается `name` то он должен устанаваливаться в значение `type`

**Поля ответа:**

| **имя поля** | **тип** | **описание**                   |
|--------------|---------|--------------------------------|
| `lid`        | uuid    | уникальный идентификатор Линки |

## 4. Обновить информацию об Линке

**Назначение:** для обновления информации об Линке. Обновляются указанные в запросе поля.

Невозможно обновить поля `compid`, `depid`, `type` и `dir`

**Запрос** `/api/v1/links/LINK_ID/update`

где `LINK_ID` – идентификатор Линки

**Тип запроса:** POST

**Пример:**  `/api/v1/links/dea50f0c-f55f-4063-9f17-e45ae8c03bce/update`

Передаваемые данные:

```json

{
  "name": "Типичный линк",
  "data": {
    "settings": {}
  }
}
```

**Ответ:**

```json

{}

```

**Возможные поля запроса:**

| **имя поля** | **тип**       | **описание**       |
|--------------|---------------|--------------------|
| `name`       | `string[255]` | наименование Линки |
| `data`       | `json`        | параметры линка    |
| `qid`        | `uuid`   | идентификатор очереди к которой привязан Линк                       |

## 5. Архивировать запись о Линке

**Назначение:** для архивации записи об Линке

**Запрос** `/api/v1/links/LINK_ID/archive`

где `LINK_ID` – идентификатор Линка

**Тип запроса:** POST

**Параметры запроса:**

| **имя поля** | **тип** | **описание**                   |
|--------------|---------|--------------------------------|
| `lid`        | `uuid`  | уникальный идентификатор Линка |

**Пример:**  `/api/v1/links/dea50f0c-f55f-4063-9f17-e45ae8c03bce/archive`

**Ответ:**

```json

{}

```

## 6. Удалить запись о Линке

**Назначение:** для удаления ранее архивированной записи об Линке

**Запрос** `/api/v1/links/LINK_ID/remove`

где `LINK_ID` – идентификатор Линка

**Тип запроса:** POST

**Параметры запроса:**

| **имя поля** | **тип** | **описание**                   |
|--------------|---------|--------------------------------|
| `lid`        | `uuid`  | уникальный идентификатор Линка |

**Пример:**  `/api/v1/links/dea50f0c-f55f-4063-9f17-e45ae8c03bce/remove`

**Ответ:**

```json

{}

```

## 7. Стартовать линк

**Назначение:** для старта ранее созданного и настроенного линка.

**Запрос:** `/api/v1/links/link_ID/start`

где `LINK_ID` – идентификатор линка

**Тип запроса:** POST

**Пример:** `/api/v1/links/dea50f0c-f55f-4063-9f17-e45ae8c03bce/start`

**Передаваемые данные:** нет

**Ответ:**

```json

{
  "meta": {},
  "response": {}
}

```

## 8. Остановить линк

**Назначение:** для остановки ранее созданного линка.

**Запрос:** `/api/v1/links/link_ID/stop`

где `LINK_ID` – идентификатор линка

**Тип запроса:** POST

**Пример:** `/api/v1/links/dea50f0c-f55f-4063-9f17-e45ae8c03bce/stop`

**Ответ:**

```json

{
  "meta": {},
  "response": {}
}

``` 

