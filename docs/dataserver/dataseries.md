# Ресурс "Временные ряды" (dataseries)

Временные ряды хранят данные наблюдений в виде **точек**.

Каждая **точка** ряда может иметь несколько **значений** измерений.


## 1. Информация по указанному ряду

**Назначение:** Получить характеристики временного ряда по идентификатору

Параметр `lastAt` позволяет сместить текущую позицию времени для поиска `lastdata`. Это нужно для того, чтобы оценить
метеорологическую обстановку на момент `lastAt`. При этом глубина поиска `lastdata` определяется параметром `lastNewer`,
либо параметром `last_data_newer` из конфига ядра.

**Запрос** `/api/v2/dataseries/DATASERIE_ID`,

где `DATASERIE_ID` - уникальный идентификатор ряда

**Тип запроса:** GET

**Возможные параметры:**

| **имя поля** | **тип**    | **описание**                                                                                                                                                                                                                  |
|--------------|------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `uid `       |            | идентификатор требуемой единицы измерения для пересчета лимитов и последнего значения                                                                                                                                         |
| `lastAt`     | `unixtime` | окончание временного диапазона для `lastdata`. Когда указывается, в качестве `lastdata` выдается последнее значение в ряде для `lastAt`. Если не указан, то принимается как `now` и `lastdata` содержит последнюю точку ряда. |
| `lastNewer`  | `int`      | глубина поиска для `lastdata` в часах. Когда указывается, перекрывает параметр `last_data_newer` из конфига ядра.                                                                                                             |
| `flag`       |            | список значений через запятую. Возможные значения:                                                                                                                                                                            |
| `-lastdata`  | `opt`      | отображать информацию по последней точке ряда                                                                                                                                                                                 |
| `-meta`      | `opt`      | отображать актуальные метаданные ряда                                                                                                                                                                                         |
| `-state`     | `opt`      | отображать статус ряда                                                                                                                                                                                                        |

**Примеры:**

* `/api/v2/dataseries/dea50f0c-f55f-4063-9f17-e82b8ca04a1f`
* `/api/v2/dataseries/dea50f0c-f55f-4063-9f17-e82b8ca04a1f&uid=1-02-52`
* `/api/v2/dataseries/dea50f0c-f55f-4063-9f17-e82b8ca04a1f?flag=lastdata`
* `/api/v2/dataseries/dea50f0c-f55f-4063-9f17-e82b8ca04a1f?attr=per.v=10&attr=per.k=M`

**Ответ:** :

```json

{
    "meta": {
        "code": 200,
        "rid": "d96bde1d-c71d-11f0-a032-02420a0001fa",
        "time": "7.211"
    },
    "response": {
        "dataseries": {
            "attr": {
                "height": {
                    "b": "SFC",
                    "k": "M",
                    "v": 2
                },
                "per": {
                    "k": "MIN",
                    "v": -10
                },
                "sig": {
                    "k": "MEAN"
                }
            },
            "state": {
              "color": "green"
            },
            "begin_obs": 1760445606,
            "caption": "ATM-AIR-TEMP",
            "created": 1760446617,
            "def": "",
            "dsgid": [
              "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
              "dea50f0c-f55f-4063-9f17-e45ae8c03bce"
            ],
            "dsid": "4482b13a-a8fd-11f0-b731-02420a00015e",
            "dstid": "ATM-AIR-TEMP-EM010MP002M",
            "end_obs": 1763428206,
            "hid": "009-XXXX-0001",
            "lastData": {
              "dt": 1503335333,
              "q": 30,
              "v": 10
            },
            "last_insert": 1763428258,
            "limits": {
              "lhv": 12.1,
              "hhv": 19.1,
              "luv": 13.6,
              "huv": 18.5,
              "hi": 0.5,
              "ui": 0.2,
              "hd": -0.6,
              "ud": -0.2,
              "lbv": 12.1,
              "hbv": 19.1,
              "bi": 0.5,
              "bd": -0.2
              "extended": null
            },
            "metadata": {
              "urn": "urn:x-wmo:md:int.wmo.wis::SIRA01URKA",
              "source": "WIS-NC-MOSCOW",
              "updated": 1504620923
            },
            "mid": "5cfec624-e4c3-11e7-80c1-9a214cf093ae",
            "name": "ATM-AIR-TEMP",
            "oid": "ATM-AIR-TEMP",
            "sid": "RU77-027420-0000",
            "state": {
                "color": "green",
                "dt": 1763428258
            },
            "uid": "1-02-23",
            "updated": 1760446617
        }
    }
}
```

**Возможные поля временного ряда:**

| **имя поля**       | **тип**    | **описание**                                                                                                                                                   |
|--------------------|------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `dsid`             | `string`   | уникальный идентификатор ряда                                                                                                                                  |
| `sid`              | `string`   | идентификатор источника от которого данные ряда                                                                                                                |
| `usid`             | `uuid`     | идентификатор пользователя, к которому отоносится ряд данных                                                                                                   |
| `eqid`             | `uuid`     | идентификатор оборудования от которого данные                                                                                                                  |
| `oid`              | `string`   | идентификатор наблюдения данных ряда                                                                                                                           |
| `uid`              | `string`   | идентификатор единицы измерения                                                                                                                                |
| `hid`              | `string`   | идентификатор узла, создавшего ряд                                                                                                                             |
| `editors`          | `array`    | список идентификаторов узлов, которым разрешена запись в ряд                                                                                                   |
| `dstid`            | `string`   | идентификатор типа ряда                                                                                                                                        |
| `name`             | `string`   | название типа ряда                                                                                                                                             |
| `caption  `        | `string`   | сокращенное название типа ряда                                                                                                                                 |
| `def`              | `string`   | описание типа ряда                                                                                                                                             |
| `create`           | `unixtime` | время создания                                                                                                                                                 |
| `begin_obs`        | `unixtime` | время первой точки ряда с ненулевым качеством.                                                                                                                 |
| `end_obs`          | `unixtime` | время последней точки ряда. Точка актуальна, т.е. качество не 0.                                                                                               |
| `last_insert`      | `unixtime` | время последней записи данных в ряд                                                                                                                            |
| `meas_hash`        | `int`      | уникальный идентификатор типа наблюдений ряда (для совместимости)                                                                                              |
| `dsgid`            | `uuid`     | идентификатор группы ряда                                                                                                                                      |
| `tgate`            | `int`      | максимальное время смещения (в секундах) при записи новой точки ряда. После превышения этого времени, точка не будет записана в ряд и будет сформирован сигнал |
| `limits`           | `json`     | группа параметров ограничений значений ряда                                                                                                                    |
| `limits.lhv`       | `float`    | низкий опасный уровень (low hazard value)                                                                                                                      |
| `limits.hhv`       | `float`    | высокий опасный уровень (high hazard value)                                                                                                                    |
| `limits.luv`       | `float`    | низкий неблагоприятный уровень (low unfavorable value)                                                                                                         |
| `limits.huv`       | `float`    | высокий неблагоприятный уровень(high unfavorablevalue)                                                                                                         |
| `limits.hi`        | `float`    | опасное приращение (hazard increase)                                                                                                                           |
| `limits.ui`        | `float`    | неблагоприятное приращение (unfavorable increase)                                                                                                              |
| `limits.hd`        | `float`    | опасное снижение (hizard decrease)                                                                                                                             |
| `limits.ud`        | `float`    | неблагоприятное снижение (unfavorable decrease)                                                                                                                |
| `limits.lbv `      | `float`    | низкий блокирующий уровень (low block value)                                                                                                                   |
| `limits.hbv`       | `float`    | высокий блокирующий уровень (high clock value)                                                                                                                 |
| `limits.bi`        | `float`    | опасное блокирующее приращение (block increase)                                                                                                                |
| `limits.bd`        | `float`    | опасное блокирующее снижение (clock decrease)                                                                                                                  |
| `attr  `           | `object`   | произвольные атрибуты ряда                                                                                                                                     |
| `attr.sig.k`       | `string`   | значимость измерений (см. таблицы ниже)                                                                                                                        |
| `attr.per.v`       | `int`      | период для периодических измерений                                                                                                                             |
| `attr.per.k`       | `string`   | тип значения периода (см. таблицы ниже)                                                                                                                        |
| `attr.dis.v`       | `int`      | дискретность (частота поступления данных)                                                                                                                      |
| `attr.dis.k`       | `string`   | тип значения дискретности (см. таблицы ниже)                                                                                                                   |
| `attr.height.v`    | `int`      | высота производства наблюдений                                                                                                                                 |
| `attr.height.k`    | `string`   | тип высоты (см. таблицы ниже)                                                                                                                                  |
| `created`          | `unixtime` | время создания сущности                                                                                                                                        |
| `updated`          | `unixtime` | время обновления сущности                                                                                                                                      |
| `metadata`         | `object`   | актуальные метаданные ряда                                                                                                                                     |
| `metadata.updated` | `unixtime` | время обновления сущности                                                                                                                                      |
| `update_usid`      | `string`   | уникальный идентификатор пользователя, который произвел обновление                                                                                             |
| `times`            | `string`   | уникальный идентификатор ряда, с которым связан текущий ряд                                                                                                    |
| `seasid`           | `uuid`     | идентификатор сезона к которому привязан ряд                                                                                                                   |
| `lastData`         | `json`     | описание последней точки ряда                                                                                                                                  |
| `lastData.dt`      | `int64`    | время измерения последней точки ряда                                                                                                                           |
| `lastData.q`       | `int`      | качество точки                                                                                                                                                 |
| `lastData.v`       | `float`    | значение точки                                                                                                                                                 |
| `state`            |            | object описание состояния ряда                                                                                                                                 |
| `state.color`      | `string`   | цвет ряда (**green, grey, orange, red**)                                                                                                                       |
| `state.dt `        | `unixtime` | время обновления состояния                                                                                                                                     |
| `state.reason `    | `array`    | массив причин (строк i18n) для обновленения состояния                                                                                                          |

